---
    published: false
    layout: html.default.post
    title: Веб-компоненты&#58; 4 года спустя
    description: SECON'2017. Доклад
    categories: [blog]
    tags: [web components, html templates, html imports, shadow dom, custom elements, polymer]
---


## Сейчас
4 года назад в Google Chrome были реализованы пилотные варианты спецификаций W3C [Web Components](http://w3c.github.io/webcomponents/explainer/):
[Shadow DOM](http://w3c.github.io/webcomponents/spec/shadow/),
[HTML Imports](http://w3c.github.io/webcomponents/spec/imports/),
[Custom Elements](http://w3c.github.io/webcomponents/spec/custom/),
[HTML Templates](https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/templates/)

За прошедшее время произошел революционный прогресс фронтенд-технологий:
*   появление и широкое использование систем сборки (Grunt/Gulp/Webpack), транспайлеров (Babel/TypeScript),
    высокопроизводительных js-фреймворков (Angular/React/Ember), css-препроцессоров (SCSS/PostCSS)
*   глобальные изменения в архитектуре фронтенда повлекли смену концепции "веб-сайт" на "веб-приложение"

Этот прогресс нивелировал актуальность веб-компонентов и сейчас необходимость их применения кажется очень сомнительной.

Какое место претендуют занять веб-компоненты в современном стеке браузерных технологий?
Зачем и как применять веб-компоненты в jquery/angular/react/<ваш_фреймворк>-приложениях?


## Web Components

### Current state
За прошедшие 4 года с момента експериментальной реализации стека Web Components в Google Chrome:
*   вышли новые версии спецификаций [Shadow DOM v1](http://caniuse.com/#feat=shadowdomv1) и
    [Custom Elements v1](http://caniuse.com/#feat=custom-elementsv1)
*   [HTML Templates](http://caniuse.com/#feat=template) реализованы во всех основных браузерах, кроме IE
*   [HTML Imports](http://caniuse.com/#feat=imports)
*   вышел [Polymer 2.0](https://www.polymer-project.org/2.0/docs/about_20)

### Shadow DOM v0 vs v1
Наибольшие изменения претерпела спецификация Shadow DOM

*   создание shadow root  
    v0: `element.createShadowRoot()`  
    v1: `element.attachShadow({ mode: 'open' || 'closed' })`

*   поддержка множественных shadow root
    v0: supported  
    v1: not supported

*   closed shadow root
    v0: not supported, shadow root is always open  
    v1: `element.attachShadow({ mode: 'closed' })`

*   shadow host
    v0: любой элемент может стать shadow host  
    v1: [список элементов регламентирован](https://dom.spec.whatwg.org/#dom-element-attachshadow)

*   основные изменения коснулись механизма распределения контента.  
    позиции отображения контента из другого дерева:  
    v0: Insertion points  
    v1: Slots

### Custom Elements v0 vs v1

*   регистрация элемента  
    v0: `window.document.registerElement('my-element', MyElement)`  
    v1: `window.customElements.define('my-element', MyElement)`

*   промис момента регистрации элемента  
    v1: `customElements.whenDefined('my-element')`

*   определение конструктора класса элемента по его имени:  
    v1: `customElements.get('element-name')`

*   хуки этапов жизненного цикла элемента:
  
{: .table }
этапы                  | Web Components v0          | Web Components v1
-----------------------|----------------------------|-------------------------
создание экземпляра    | `createdCallback`          | `constructor`
добавление в DOM       | `attachedCallback`         | `connectedCallback`
изменение атрибутов    | `attributeChangedCallback` | `attributeChangedCallback`
добавление в чужой DOM | —                          | `adoptedCallback`
удаление из DOM        | `detachedCallback`         | `disconnectedCallback`


### Polymer RC2

## Web Components & JS-frameworks

### Что выбрать: Web Components или JS-framework?
Обрадую - вам не придется делать этот выбор.
Нет необходимости отказываться от любимого фреймворка в пользу веб-компонентов и наоборот.
Компоненты, разработанные на базе стандартов web components можно использовать с любым js-фреймворком:
*   с точки зрения браузера (и фреймворка) они принципиально ничем не должны отличаться от нативных html-элементов
*   они реализуются механизмами браузера - т.е. на более низком уровне, чем фреймфорк

### Реализация "чистого" веб-компонента

### JQuery & Web Components

Это самый простой случай

### React & Web Components
В существующем стеке JS-фреймворков веб-компоненты наиболее близки к ReactJS:
*   предоставляют средства инкапсуляции верстки, стилей и логики работы компонента

{: .table }
&nbsp;                | Web Components  | ReactJS
----------------------|-----------------|--------
Верстка               | HTML Templates  | JSX
Средства инкапсуляции | Custom Elements | JSX

### Angular2 & Web Components

Angular2: 3 режима инкапсуляции

## Polymer


## [Vaadin](https://vaadin.com)
*   Works on any HTML5 based stack.
*   Supports Polymer and Angular 2 data binding.