---
    published: false
    layout: html.presentation
    title: Веб-компоненты&#58; 4 года спустя
    description: SECON'2017. Презентация к докладу
    categories: [presentations]
    tags: [web components, html templates, html imports, shadow dom, custom elements, polymer]
---


<section markdown="1">

{: .highlight }
# [WEB COMPONENTS](http://w3c.github.io/webcomponents/explainer/)

## 4 года спустя

{: .highlight }
### http://goo.gl/BlIWaB

{: .text-center }
[<i class="fa fa-2x fa-qrcode"
    title="QR-код страницы"
    data-toggle="modal" data-target="#modal-qr"></i>](#)


</section>

<!-- 01 -------------------------------------------------------------------- -->

<section markdown="1">

## [WEB COMPONENTS](http://w3c.github.io/webcomponents/explainer/)

{: .text-center }
[Shadow DOM](http://w3c.github.io/webcomponents/spec/shadow/), [Custom Elements](http://w3c.github.io/webcomponents/spec/custom/), [HTML Templates](https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/templates/index.html), [HTML Imports](http://w3c.github.io/webcomponents/spec/imports/)

{: .fragment .highlight-current-blue }
Предоставляют нативные средства разработки расширяемых и ре-используемых UI-компонент,  
содержат средства описания шаблона, стилей и логики компонента,
а также механизм их инкапсуляции в единую независимую сущность.

{: .fragment .highlight-current-blue .no-border}
[Shadow DOM v1](http://caniuse.com/#feat=shadowdomv1)|[<i class="fa fa-chrome"/> <i class="fa fa-opera"/>](https://www.chromestatus.com/features/4667415417847808)
-----------------------------------------------------|------------------------------------------------------------------------------------------------------------
[Custom Elements v1](http://caniuse.com/#feat=custom-elementsv1)|[<i class="fa fa-chrome"/> <i class="fa fa-opera"/>](https://www.chromestatus.com/features/4696261944934400)
[HTML Templates](http://caniuse.com/#feat=template)|[<i class="fa fa-chrome"/> <i class="fa fa-opera"/>](https://www.chromestatus.com/features/5207287069147136) [<i class="fa fa-firefox"/>](http://bugzil.la/818976) [<i class="fa fa-safari"/>](https://bugs.webkit.org/show_bug.cgi?id=123851) [<i class="fa fa-edge"/>](https://developer.microsoft.com/en-us/microsoft-edge/platform/status/templateelement/)
[HTML Imports](http://caniuse.com/#feat=imports)|[<i class="fa fa-chrome"/> <i class="fa fa-opera"/>](https://www.chromestatus.com/features/5144752345317376)
[Polymer v2](https://www.polymer-project.org/2.0/docs/about_20)|[<i class="fa fa-chrome"/> <i class="fa fa-opera"/> <i class="fa fa-firefox"/> <i class="fa fa-safari"/> <i class="fa fa-edge"/> <i class="fa fa-internet-explorer"/>](https://www.polymer-project.org/2.0/docs/about_20#browser-support-and-polyfills)

</section>

<!-- 02 -------------------------------------------------------------------- -->

<section markdown="1">

## [Shadow DOM: `v.0` vs `v.1`](https://hayato.io/2016/shadowdomv1/)

*   {: .fragment .highlight-current-blue }
    создание shadow root  
    `v.0:` `element.createShadowRoot()`  
    `v.1:` `element.attachShadow({ mode: ... })`

*   {: .fragment .highlight-current-blue }
    поддержка множественных shadow root  
    `v.0:` поддерживается  
    `v.1:` не поддерживается

*   {: .fragment .highlight-current-blue}
    closed shadow root  
    `v.0:` не поддерживается, shadow root постоянно доступен извне: `e.shadowRoot`  
    `v.1:` режим задается: `element.attachShadow({ mode: 'open' || 'closed' })`  
    работа геттеров `e.shadowRoot`, `e.assignedSlot` зависит от режима

*   {: .fragment .highlight-current-blue }
    shadow host  
    `v.0:` любой элемент может стать shadow host  
    `v.1:` [список элементов регламентирован](https://dom.spec.whatwg.org/#dom-element-attachshadow)

*   {: .fragment .highlight-current-blue }
    механизм распределения контента -
    позиции отображения контента из другого дерева:  
    `v.0:` Insertion points  
    `v.1:` Slots

</section>

<!-- 03 -------------------------------------------------------------------- -->

<section markdown="1">

## [Custom Elements: `v.0` vs `v.1`](https://github.com/shawnbot/custom-elements)

*   {: .fragment .highlight-current-blue }
    регистрация элемента  
    `v.0:` `window.document.registerElement('my-element', MyElement)`  
    `v.1:` `window.customElements.define('my-element', MyElement)`

*   {: .fragment .highlight-current-blue }
    промис момента регистрации элемента  
    `v.1:` `customElements.whenDefined('my-element')`

*   {: .fragment .highlight-current-blue }
    определение конструктора класса элемента по его имени:  
    `v.1:` `customElements.get('element-name')`

*   хуки жизненного цикла элемента:

{: .fragment .highlight-current-blue .no-border}
&nbsp;                 | Custom Elements v0         | Custom Elements v1
-----------------------|----------------------------|-------------------------
создание экземпляра    | `createdCallback`          | `constructor`
добавление в DOM       | `attachedCallback`         | `connectedCallback`
изменение атрибутов    | `attributeChangedCallback` | `attributeChangedCallback`
добавление в чужой DOM | —                          | `adoptedCallback`
удаление из DOM        | `detachedCallback`         | `disconnectedCallback`

</section>

<!-- 04 -------------------------------------------------------------------- -->

<section markdown="1">

## [Polymer: `v.1` vs `v.2`](https://www.polymer-project.org/2.0/docs/about_20)

*   {: .fragment .highlight-current-blue }
    поддержка Shadow DOM v.1, Custom Elements v.1

*   {: .fragment .highlight-current-blue }
    **больше не поддерживается** "расширение" нативных элементов (`<input is="my-input">`)

*   {: .fragment .highlight-current-blue }
    реализован слой совместимости с Polymer v.1

*   {: .fragment .highlight-current-blue }
    использование ES6-классов для создания компонент,
    поддержка создания компонент с использованием фабрики для совместимости с `v.1`

*   {: .fragment .highlight-current-blue }
    жизненный цикл
    для class-based компонентов аналогичнен Custom Elements v.1,  
    для fabric-based компонентов поддерживается жизненный цикл Polymer v.1

{: .table }
&nbsp;              | Polymer v1 (fabric-based) | Polymer v2 (class-based)
--------------------|---------------------------|---------------------------
создание экземпляра | `created`                 | `constructor`
добавление в DOM    | `attached`                | `connectedCallback`
изменение атрибутов | `attributeChanged`        | `attributeChangedCallback`
удаление из DOM     | `detached`                | `disconnectedCallback`
готовоность DOM     | `ready`                   | `ready`

</section>

<!-- 05 -------------------------------------------------------------------- -->

<section markdown="1">

## [Polymer: поддержка браузерами]()



</section>

<!-- 07 -------------------------------------------------------------------- -->

<section markdown="1">

## [SHADOW DOM](http://w3c.github.io/webcomponents/explainer/#shadow-dom-section)<br /><small>пример</small>

~~~html
<button class="bws"><u>Get time...</u></button>
<script>(function(){
    var host = document.querySelector('.bws'); // находим host-элемент
    host.onclick = function(){
        var root = host.createShadowRoot();    // создаем ShadowRoot-деревo
        root.textContent = (new Date()).toLocaleTimeString(); // наполняем
    };
})();</script>
~~~

{: .example .fragment }
><div id="example-7" markdown="0">
>    <button class="bws inline-block">
>        <u>Get time...</u>
>    </button>
></div>
><script>
>(function(){
>    var host = document.querySelector('#example-7 > button');
>    host.onclick = function(){
>        var root = host.createShadowRoot();
>        root.textContent = (new Date()).toLocaleTimeString();
>    };
>})();
></script>

</section>

<!-- 08 -------------------------------------------------------------------- -->

<section markdown="1">

## [SHADOW DOM](http://w3c.github.io/webcomponents/explainer/#shadow-dom-section)<br /><small>управление контентом, механизм распределения</small>

{: .fragment .highlight-current-blue }
В теневом дереве отмечаются *точками вставки* (*[insertion points](http://w3c.github.io/webcomponents/spec/shadow/#insertion-points)*) 
позиции отображения контента из другого дерева, 
а [механизм распределения](http://w3c.github.io/webcomponents/spec/shadow/#distributions) отображает в них указанный контент, 
не меняя при этом ни одно из этих деревьев.  

* {: .fragment .highlight-current-blue } [content insertion points](http://w3c.github.io/webcomponents/spec/shadow/#content-insertion-points) распределяет контент *host*-ноды, 
  ([&lt;content/&gt;](http://w3c.github.io/webcomponents/spec/shadow/#the-content-element),
   [HTMLContentElement](http://w3c.github.io/webcomponents/spec/shadow/#the-content-element))  
* {: .fragment .highlight-current-blue } [shadow insertion point](http://w3c.github.io/webcomponents/spec/shadow/#shadow-insertion-points) распределяет контент предыдущего *ShadowRoot*, 
  ([&lt;shadow/&gt;](http://w3c.github.io/webcomponents/spec/shadow/#the-shadow-element),
   [HTMLShadowElement](http://w3c.github.io/webcomponents/spec/shadow/#the-shadow-element))  

{: .fragment .highlight-current-blue }
*Distributed nodes* - ноды, распределенные в *Shadow DOM* точками вставки, недоступны с помощью обычных селекторов.

</section>

<!-- 09 -------------------------------------------------------------------- -->

<section markdown="1">

## [SHADOW DOM](http://w3c.github.io/webcomponents/explainer/#shadow-dom-section)<br /><small>[content insertion points](http://w3c.github.io/webcomponents/spec/shadow/#content-insertion-points), [shadow insertion points](http://w3c.github.io/webcomponents/spec/shadow/#shadow-insertion-points)</small>

~~~html
<button class="bws">Get time...</button>
<script>(function(){
    var host = document.querySelector('.bws');
    host.onclick = function(){
       var root = host.createShadowRoot();
       root.innerHTML = '<content></content><shadow></shadow> / '+
                        '<b>'+(new Date()).toLocaleTimeString()+'</b>';
       };
})();</script>
~~~

{: .example .fragment }
><div id="example-9" markdown="0">
>    <button>Get time...</button>
></div>
><script>
>(function(){
>    var host = document.querySelector('#example-9 > button');
>    host.onclick = function(){
>       var time = (new Date()).toLocaleTimeString(),
>           root = this.createShadowRoot();
>       root.innerHTML =
>            '<content></content>'+
>            '<shadow></shadow> / '+
>            '<b>'+time+'</b>';
>       };
>})();
></script>

</section>

<!-- 10 -------------------------------------------------------------------- -->

<section markdown="1">

## [HTML TEMPLATES](http://w3c.github.io/webcomponents/explainer/#template-section)  

#### `HTMLTemplateElement` / `<template />`

* {: .fragment .highlight-current-blue } могут быть объявлены внутри `<head>`, `<body>`, `<frameset>`
* {: .fragment .highlight-current-blue } контент шаблона анализируется парсером как HTML
* {: .fragment .highlight-current-blue } контент не активен
* {: .fragment .highlight-current-blue } контент не является частью документа
* {: .fragment .highlight-current-blue } контент хранится в поле `.content` объекта *HTMLTemplateElement* в виде объекта *DocumentFragment*

</section>

<!-- 11 -------------------------------------------------------------------- -->

<section markdown="1">

## [HTML TEMPLATES](http://w3c.github.io/webcomponents/explainer/#template-section)<br /><small>пример</small>

~~~html
<button class="bws">Get time...</button>
<template class="bws">
    <content></content><shadow></shadow> / <b></b>
</template>
<script>(function(){
var host = document.querySelector('button.bws'),
    template = document.querySelector('template.bws');
host.onclick = function(){
    var root = host.createShadowRoot(),
        content = template.content.cloneNode(true);
    content.querySelector('b').textContent = (new Date()).toLocaleTimeString();
    root.appendChild(content);
    };
})();</script>
~~~

{: .example .fragment }
><div id="example-11" markdown="0">
>    <button>Get time...</button>
>    <template>
>        <content></content>
>        <shadow></shadow>
>        <b></b>
>    </template>
></div>
><script>
>(function(){
>    var example = document.querySelector('#example-11')
>        host = example.querySelector('button'),
>        template = example.querySelector('template');
>    host.onclick = function(){
>       var time = (new Date()).toLocaleTimeString(),
>           root = this.createShadowRoot(),
>           $template = template.content.cloneNode(true);
>       $template.querySelector('b').textContent = time;
>       root.appendChild($template);
>       };
>})();
></script>

</section>

<!-- 12 -------------------------------------------------------------------- -->

<section markdown="1">

## SHADOW DOM<br /><small>инкапсуляция стилей, shadow boundary</small>

{: .fragment .highlight-current-blue }
Каждое теневое дерево отделено от внешнего мира границей *shadow boundary*.  

{: .fragment .highlight-current-blue }
Применение стилей внутри *shadow boundary* (для *host*-элемента, для *distributed*-элементов) имеет свои особенности.

* {: .fragment .highlight-current-blue } граница непрозрачна изнутри
* {: .fragment .highlight-current-blue } пропускает [наследуемые свойства](http://www.impressivewebs.com/inherit-value-css/) стилей основного дерева  
  `root.resetStyleInheritance // (default:false)`
* {: .fragment .highlight-current-blue } может быть прозрачна для стилей основного документа  
  `root.applyAuthorStyles // (default:false)`
* {: .fragment .highlight-current-blue } селектор `:host` для *host*-элемента теневого дерева
* {: .fragment .highlight-current-blue } селектор `::distributed` `::content`{: .del } для *distributed*-элементов, распределенных *insertion points*
* {: .fragment .highlight-current-blue } селектор `^` указывает переход через одну *shadow boundary*
* {: .fragment .highlight-current-blue } селектор `^^` указывает переход через любое число *shadow boundary*

</section>

<!-- 13 -------------------------------------------------------------------- -->

<section markdown="1">

## SHADOW DOM<br /><small>инкапсуляция стилей. пример</small>

~~~html
<button class="bws">Get time...</button>
<template class="bws">
    <style>
        :host { background-color:#0f0; }
        :host:hover { background-color:#ff0; }
        :host:active { background-color:#f00; }
        b { color:#00f }
    </style>
    <content></content><shadow></shadow> / <b></b>
</template>
<script>(function(){
var host = document.querySelector('button.bws'),
    template = document.querySelector('template.bws');
host.onclick = function(){
    var root = host.createShadowRoot(),
        content = template.content.cloneNode(true);
    content.querySelector('b').textContent = (new Date()).toLocaleTimeString();
    root.appendChild(content);
    };
})();</script>
~~~

{: .example .fragment }
><div id="example-13" markdown="0">
>    <button>Get time...</button>
>    <template>
>        <style>
>            :host { background-color:#0f0; }
>            :host:hover { background-color:#ff0; }
>            :host:active { background-color:#f00; }
>            b { color:#00f }
>        </style>
>        <content></content><shadow></shadow> / <b></b>
>    </template>
></div>
><script>
>(function(){
>    var example = document.querySelector('#example-13')
>        host = example.querySelector('button'),
>        template = example.querySelector('template');
>    host.onclick = function(){
>       var time = (new Date()).toLocaleTimeString(),
>           root = this.createShadowRoot(),
>           $template = template.content.cloneNode(true);
>       $template.querySelector('b').textContent = time;
>       root.appendChild($template);
>       };
>})();
></script>

</section>

<!-- 14 -------------------------------------------------------------------- -->

<section markdown="1">

## [HTML IMPORTS](http://w3c.github.io/webcomponents/explainer/#imports-section)

Инструменты импорта: 
`CSS: <link rel="stylesheet">`{: .fragment .highlight-current-blue } 
`JS: <script src="">`{: .fragment  .highlight-current-blue} 
`VIDEO: <video>`{: .fragment .highlight-current-blue } 
`AUDIO: <audio>`{: .fragment .highlight-current-blue }  

{: .fragment .highlight-current-blue .text-center}
####`HTML: ???!!!`{: .bold }  

Импорт разметки: `<iframe>`{: .fragment .highlight-current-blue } `AJAX`{: .fragment .highlight-current-blue } `<script type="">`{: .fragment .highlight-current-blue }

{: .fragment .highlight-current-blue .text-center}
#### [W3C HTML Imports](http://w3c.github.io/webcomponents/spec/imports/#link-type-import) : `<link rel="import">`{: .bold }

{: .highlight }
Особенности:

* {: .fragment .highlight-current-blue } повторные импорты отсекаются браузером
* {: .fragment .highlight-current-blue } валидируется браузером как HTML
* {: .fragment .highlight-current-blue } контент может использовать внешние ресурсы (js, css, img,...)
* {: .fragment .highlight-current-blue } для кросс-доменных импортов используется [CORS](http://habrahabr.ru/post/114432/)
* {: .fragment .highlight-current-blue } onload / onerror events
* {: .fragment .highlight-current-blue } контент ресурса хранится в поле `.import` объекта *HTMLLinkElement* (`<link />`)
* {: .fragment .highlight-current-blue } контент представлен в виде объекта *HTMLDocument*

</section>

<!-- 15 -------------------------------------------------------------------- -->

<section markdown="1">

## [HTML IMPORTS](http://w3c.github.io/webcomponents/explainer/#imports-section)<br /><small>применение</small>

* {: .fragment .highlight-current-blue } декомпозиция веб-приложения
* {: .fragment .highlight-current-blue } объединение загрузки ресурсов ( js, css, images, ... )

{: .fragment .highlight-current-blue .text-left }
#### index.html

~~~html 
<html>
    <head>
        <link rel="import" href="bootstrap.html">
    </head>
    <body>
        <!-- ... -->
    </body>
</html>
~~~

{: .fragment .highlight-current-blue .text-left }
#### bootstrap.html

~~~html
<link rel="stylesheet" href="bootstrap.css">
<link rel="stylesheet" href="fonts.css">
<script src="jquery.js"></script>
<script src="bootstrap.js"></script>
~~~

</section>

<!-- 16 -------------------------------------------------------------------- -->

<section markdown="1">

## [HTML IMPORTS](http://w3c.github.io/webcomponents/explainer/#imports-section)<br /><small>динамическая загрузка. обработка событий</small>

~~~html
<button class="known">Load resource ...</button>
<button class="unknown">Load unknown resource ...</button>
<script>(function(){
    function loader(href){
        var link = document.createElement('link');
        link.rel = 'import';
        link.href = href;
        link.onload = function(e) {
            alert( link.href+'\n'+e.type+'\n'+
                   link.import.documentElement.innerHTML+'\n');
        };
        link.onerror = function(e) { alert(link.href+'\n'+e.type); };
        document.head.appendChild(link);
    }
    document.querySelector('button.known')
        .onclick=function(){loader('/assets/posts/2014-02-20/import.html')};
    document.querySelector('button.unknown')
        .onclick=function(){loader('/anyfile')};
})();</script>
~~~

{: .example .fragment }
><div id="example-16" markdown="0">
>    <button class="known">Load resource ...</button>
>    <button class="unknown">Load unknown resource ...</button>
></div>
><script>
>(function(){
>    function loader(href){
>       var link = document.createElement('link');
>       link.rel = 'import';
>       link.href = href;
>       link.onload = function(e) { alert(link.href+'\n'+e.type+'\n'+link.import.documentElement.innerHTML); };
>       link.onerror = function(e) { alert(link.href+'\n'+e.type); };
>       document.head.appendChild(link);
>    }
>    var example = document.querySelector('#example-16');
>    example.querySelector('button.known')
>           .onclick = function(){ loader('/assets/posts/2014-02-20/import.html') };
>    example.querySelector('button.unknown')
>           .onclick = function(){ loader('/anyfile') };
>})();
></script>

</section>

<!-- 17 -------------------------------------------------------------------- -->

<section markdown="1">

## [HTML IMPORTS](http://w3c.github.io/webcomponents/explainer/#imports-section)<br /><small>динамическая загрузка шаблона</small>

~~~html
<button class="bws">Load my template ...</button>
<script>
(function(){
    function loader(href){
       var link = document.createElement('link');
       link.rel = 'import';
       link.href = href;
       link.onload = function(e) {
           alert(link.href+'\n'+e.type+'\n'+link.import.documentElement.innerHTML);
           var template = link.import.querySelector('template'),
               root = host.createShadowRoot();
           root.appendChild(template.content.cloneNode(true));
       };
       link.onerror = function(e) { alert(link.href+'\n'+e.type); };
       document.head.appendChild(link);
    }
    var host = document.querySelector('.bws');
    host.onclick = function(){ loader('/assets/posts/2014-02-20/import.html') };
})();</script>
~~~

{: .example .fragment }
><div id="example-17" markdown="0">
>    <button>Load my template ...</button>
></div>
><script>(function(){
>    function loader(href){
>       var link = document.createElement('link');
>       link.rel = 'import';
>       link.href = href;
>       link.onload = function(e) {
>           alert(link.href+'\n'+e.type+'\n'+link.import.documentElement.innerHTML);
>           var template = link.import.querySelector('template'),
>               root = host.createShadowRoot();
>           root.appendChild(template.content.cloneNode(true));
>       };
>       link.onerror = function(e) { alert(link.href+'\n'+e.type); };
>       document.head.appendChild(link);
>    }
>    var host = document.querySelector('#example-17 button');
>    host.onclick = function(){ loader('/assets/posts/2014-02-20/import.html') };
>})();
></script>

</section>

<!-- 18 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)

{: .text-left }
#### Эволюция верстки: 
`плоская`{: .fragment .highlight-current-blue } 
`фреймы`{: .fragment .highlight-current-blue } 
`табличная`{: .fragment .highlight-current-blue } 
`слои`{: .fragment .highlight-current-blue } 
`JS UI frameworks`{: .fragment .highlight-current-blue } 
`семантическая разметка`{: .fragment .highlight-current-blue } 
`bootsrap-like frameworks`{: .fragment .highlight-current-blue }  

{: .fragment .text-left }
#### Модальное окно *bootstrap*:

{: .fragment }
~~~html
<div class="modal fade" id="myModal"
     tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close"
                data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Modal title</h4>
      </div>
      <div class="modal-body"> ... </div>
      <div class="modal-footer"> ... </div>
    </div>
  </div>
</div>
~~~

{: .fragment .text-left }
#### Завтра: `???`


</section>

<!-- 19 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)

{: .fragment .highlight-current-blue .text-left }
#### Завтра: `Web component based UI framework` 

{: .fragment .highlight-current-blue .text-left }
#### Модальное окно *x-bootstrap-modal*:

~~~html
<x-bootstrap-modal hidden overlay cancel-click-hide esc-hide>
    <x-bootstrap-modal-header>
        Modal title<x-bootstrap-button type="close" />
    <x-bootstrap-modal-header>
    <x-bootstrap-modal-body> ... </x-bootstrap-modal-body>
    <x-bootstrap-modal-footer> ... </x-bootstrap-modal-footer>
</x-bootstrap-modal>
~~~

{: .text-left }
#### Преимущества:

* {: .fragment .highlight-current-blue } следующий шаг к семантической разметке
* {: .fragment .highlight-current-blue } еще один уровень декомпозиции UI-компонентов:  
  *разметка/стили/поведение*{: .fragment .highlight-current-blue .small }
  *структура/шаблон/стили/поведение*{: .fragment .highlight-current-blue .small }
* {: .fragment .highlight-current-blue } модульный, удобочитаемый код
* {: .fragment .highlight-current-blue } возможность создавать независимые от контекста виджеты с удобным API и инкапсулированным внутренним представлением

</section>

<!-- 20 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)<br /><small>возможности</small>

* {: .fragment .highlight-current-blue } создавать новые типы HTML/DOM элементов
* {: .fragment .highlight-current-blue } создавать новые типы расширением существующих
* {: .fragment .highlight-current-blue } логически объединять разнородный функционал в одном теге
* {: .fragment .highlight-current-blue } расширять API существующих DOM-компонентов

</section>

<!-- 21 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)<br /><small>создание новых типов</small>

{: .fragment .highlight-current-blue .text-left }
####`document.registerElement('tag-name', [{prototype:{}}])`

* {: .fragment .highlight-current-blue } *имя тега* должно содержать дефис
* {: .fragment .highlight-current-blue } *прототип* создаваемого элемента (`HTMLElement.prototype`)

~~~js
var XElement = document.registerElement('x-element'),
    xe = new XElement();
xe.innerHTML="[<b>XElement</b>]";
document.body.appendChild( xe );
~~~

{: .example .fragment }
><div id="example-21" markdown="0">
>    <button>Test ...</button>
></div>
><script>
> var XElement = document.registerElement('x-element');
>(function(){
>    var example = document.querySelector('#example-21');
>    example.querySelector('button')
>           .onclick = function(){
>               var xe = new XElement();
>               xe.innerHTML="[<b>XElement</b>]";
>               example.appendChild(xe);
>               alert(example.outerHTML);
>            };
>})();
></script>

</section>

<!-- 22 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)<br /><small>создание нового типа расширением существующего</small>

{: .fragment .highlight-current-blue }
*Расширение <<нативного>> элемента*:

~~~js
var XButton = document.registerElement('x-button', {
        prototype: Object.create(HTMLButtonElement.prototype), extends: 'button'
    }),
    xb = new XButton(); xb.value = "<b>XButton</b>";
document.body.appendChild( xb );
~~~

{: .example }
><div id="example-22-1" markdown="0">
>    <button>new XButton()</button>
></div>
><script>
>var XButton = document.registerElement('x-button', {
>   prototype: Object.create(HTMLButtonElement.prototype),
>   extends: 'button'
>   });
>(function(){
>    var example = document.querySelector('#example-22-1');
>    example.querySelector('button')
>           .onclick = function(){
>               var xb = new XButton();
>               xb.innerHTML="<b>XButton</b>";
>               example.appendChild(xb);
>               alert(example.outerHTML);
>            };
>})();
></script>

{: .fragment .highlight-current-blue }
*Расширение <<пользовательского>> элемента*:

~~~js
var XElement = document.registerElement('x-element'),
    XElementExt = document.registerElement('x-element-ext', {
       prototype: Object.create(XElement.prototype)
    }),
    xee = new XElementExt(); xee.innerHTML="[<b>XElementExt</b>]";
document.body.appendChild( xee );
~~~

{: .example }
><div id="example-22-2" markdown="0">
>    <button>new XElementExt()</button>
></div>
><script>
>var XElementExt = document.registerElement('x-element-ext', {
>       prototype: Object.create(XElement.prototype)
>       });
>(function(){
>    var example = document.querySelector('#example-22-2');
>    example.querySelector('button')
>           .onclick = function(){
>               var xee = new XElementExt();
>               xee.innerHTML="[<u>XElementExt</u>]";
>               example.appendChild(xee);
>               alert(example.outerHTML);
>            };
>})();
></script>

</section>

<!-- 23 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)<br /><small>создание экземпляров элементов</small>

{: .fragment .highlight-current-blue }
Для *custom elements* применяется общепринятая техника инстанцирования экземпляров:  

* {: .fragment .highlight-current-blue } тегом в разметке: `<tag-name></tag-name>`
* {: .fragment .highlight-current-blue } созданием ноды: `document.createElement('tag-name')`
* {: .fragment .highlight-current-blue } при помощи конструктора: `new XTag()`

</section>

<!-- 24 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)<br /><small>создание экземпляров пользовательских элементов</small>

{: .text-left .highlight }
#### Тегом в разметке

~~~html
<script>
    var XElement = document.registerElement('x-element');
</script>
<x-element onclick="alert(this.outerHTML)">XElement</x-element>
~~~

{: .example .fragment }
><x-element markdown="0"
>           onclick="alert(this.outerHTML)">XElement</x-element>

</section>

<!-- 25 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)<br /><small>создание экземпляров пользовательских элементов</small>

{: .text-left .highlight }
#### Cозданием ноды

~~~html
<div id="example"></div>
<script>
    var XElement = document.registerElement('x-element');
    (function(){
        var xe = document.createElement('x-element');
        xe.textContent = "XElement";
        xe.addEventListener('click', function(e){ alert(this.outerHTML); });
        document.querySelector('#example')
                .appendChild( xe );
    })();
</script>
~~~

{: .example .fragment }
><div id="example-25"  markdown="0"></div>
><script>(function(){
>    var xe = document.createElement('x-element');
>    xe.textContent = "XElement";
>    xe.addEventListener('click', function(e){ alert(this.outerHTML); });
>    document.querySelector('#example-25')
>            .appendChild( xe );
>})();</script>

</section>

<!-- 26 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)<br /><small>создание экземпляров пользовательских элементов</small>

{: .text-left .highlight }
#### При помощи конструктора

~~~html
<div id="example"></div>
<script>
    var XElement = document.registerElement('x-element');
    (function(){
        var xe = new XElement();
        xe.textContent = "XElement";
        xe.addEventListener('click', function(e){ alert(this.outerHTML); });
        document.querySelector('#example')
                .appendChild( xe );
    })();
</script>
~~~

{: .example .fragment }
><div id="example-26" markdown="0"></div>
><script>(function(){
>    var xe = document.createElement('x-element');
>    xe.textContent = "XElement";
>    xe.addEventListener('click', function(e){ alert(this.outerHTML); });
>    document.querySelector('#example-26')
>            .appendChild( xe );
>})();</script>

</section>

<!-- 27 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)<br /><small>создание экземпляров расширенных элементов</small>

{: .text-left .highlight }
#### Тегом в разметке

~~~html
<script><!--
var XButton = document.registerElement('x-button', {
    prototype: Object.create(HTMLButtonElement.prototype),
    extends: 'button'
    });
</script>
<button is="x-button"
        onclick="alert(this.outerHTML)">x-button</button>
~~~

{: .example .fragment }
><div markdown="0">
>    <button is="x-button"
>            onclick="alert(this.outerHTML)">x-button</button>
></div>

</section>

<!-- 28 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)<br /><small>создание экземпляров расширенных элементов</small>

{: .text-left .highlight }
#### Созданием ноды

~~~html
<div id="example"></div>
<script>
    var XButton = document.registerElement('x-button', {
        prototype: Object.create(HTMLButtonElement.prototype),
        extends: 'button'
        });
    (function(){
        var xb = document.createElement('button', 'x-button');
        xb.textContent = "XButton";
        xb.addEventListener('click', function(e){ alert(this.outerHTML); });
        document.querySelector('#example')
                .appendChild( xb );
    })();
</script>
~~~

{: .example .fragment }
><div id="example-28"  markdown="0"></div>
><script>(function(){
>    var xb = document.createElement('button', 'x-button');
>    xb.textContent = "XButton";
>    xb.addEventListener('click', function(e){ alert(this.outerHTML); });
>    document.querySelector('#example-28')
>            .appendChild( xb );
>})();</script>

</section>

<!-- 29 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)<br /><small>создание экземпляров расширенных элементов</small>

{: .text-left .highlight }
#### При помощи конструктора

~~~html
<div id="example"></div>
<script>
    var XButton = document.registerElement('x-button', {
        prototype: Object.create(HTMLButtonElement.prototype),
        extends: 'button'
        });
    (function(){
        var xb = new XButton();
        xb.textContent = "XButton";
        xb.addEventListener('click', function(e){ alert(this.outerHTML); });
        document.querySelector('#example')
                .appendChild( xb );
    })();
</script>
~~~

{: .example .fragment }
><div id="example-29"  markdown="0"></div>
><script>(function(){
>    var xb = new XButton();
>    xb.textContent = "XButton";
>    xb.addEventListener('click', function(e){ alert(this.outerHTML); });
>    document.querySelector('#example-29')
>            .appendChild( xb );
>})();</script>

</section>

<!-- 30 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)<br /><small>добавление свойств и методов</small>

~~~html
<div id="example"></div>
<script>
    // создаем прототип
    var YElementProto = Object.create(HTMLElement.prototype);
    
    // добавляем метод
    YElementProto.alertme = function() { alert(this.outerHTML); };
    // добавляем поле
    YElementProto.defaultvalue = 999;
    
    // регистрируем элемент
    var YElement=document.registerElement( 'y-element',
                                           {prototype:YElementProto} );
    (function(){
        // создаем экземпляр
        var ye = new YElement(); // document.createElement('y-element');
        ye.textContent = "YElement";
        ye.addEventListener('click', function(e){ this.alertme();
                                                  alert(this.defaultvalue); });
        // добавляем в DOM
        document.querySelector('#example')
                .appendChild( ye );
    })();
</script>
~~~

{: .example .fragment }
><div id="example-30"  markdown="0"></div>
><script>
>    var YElementProto = Object.create(HTMLElement.prototype);
>    YElementProto.alertme = function() { alert(this.outerHTML); };
>    YElementProto.defaultvalue = 999;
>    var YElement=document.registerElement('y-element',{prototype:YElementProto});
>
>   (function(){
>       var ye = new YElement();
>       ye.textContent = "YElement";
>       ye.addEventListener('click', function(e){ this.alertme();
                                                  alert(this.defaultvalue); });
>       document.querySelector('#example-30')
>               .appendChild( ye );
>   })();
></script>

</section>

<!-- 31 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)<br /><small>жизненный цикл</small>

{: .fragment .highlight-current-blue }
Спецификация позволяет отслеживать жизненный цикл *custom element* посредством вызова его *callback*-методов:

* {: .fragment .highlight-current-blue } `createdCallback` : создание экземпляра
* {: .fragment .highlight-current-blue } `attachedCallback` : добавление в документ
* {: .fragment .highlight-current-blue } `detachedCallback` : извлечение из документа
* {: .fragment .highlight-current-blue } `attributeChangedCallback` : добавление, удаление или изменение аттрибутов

</section>

<!-- 32 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)<br /><small>жизненный цикл</small>

~~~html
<button id="example">+ZElement</button>
<script>
    var ZElementProto = Object.create(HTMLElement.prototype);
    ZElementProto.createdCallback = function(){ alert('created: '+this); };
    ZElementProto.attachedCallback = function(){ alert('attached: '+this); };
    var ZElement=document.registerElement('z-element',{prototype:ZElementProto});
    (function(){
        document.querySelector('#example')
                .onclick = function(){
                    var ze = new ZElement();
                    ze.innerHTML="[<b>ZElement</b>]";
                    ze.onclick=function(){ alert(this.outerHTML); };
                    example.appendChild(ze);
                 };
    })();
</script>
~~~

{: .example .fragment }
><div id="example-32" markdown="0">
>    <button>+ZElement</button>
></div>
><script>
>    var ZElementProto = Object.create(HTMLElement.prototype);
>    ZElementProto.createdCallback = function(){ alert('created: '+this); };
>    ZElementProto.attachedCallback = function(){ alert('attached: '+this); };
>    var ZElement=document.registerElement('z-element',{prototype:ZElementProto});
>    (function(){
>        var example = document.querySelector('#example-32');
>        example.querySelector('button')
>               .onclick = function(){
>                   var ze = new ZElement();
>                   ze.innerHTML="[<b>ZElement</b>]";
>                   ze.onclick=function(){ alert(this.outerHTML); };
>                   example.appendChild(ze);
>                };
>    })();
></script>

</section>

<!-- 34 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)<br /><small>инкапсуляция стилей и разметки</small>

~~~html
<div id="example"></div>
<template class="t-button">
    <style> :host { background-color:#0f0; }
            :host:hover { background-color:#ff0; }
            :host:active { background-color:#f00; }
            b { color:#00f } </style>
    <content></content><shadow></shadow> / <b></b>
</template>
<script>
    var TButtonTemplate = document.querySelector('template.t-button');
    var TButtonPrototype = Object.create(HTMLButtonElement.prototype);
    TButtonPrototype.createdCallback = function(){
        this.textContent = "TButton";
        this.addEventListener('click', function(e){ alert(this.outerHTML); });
        var root = host.createShadowRoot(),
            content = TButtonTemplate.content.cloneNode(true);
        content.querySelector('b').textContent = (new Date()).toLocaleTimeString();
        root.appendChild(content);
    };
    var TButton = document.registerElement('t-button', {
        prototype: TButtonPrototype, extends: 'button'
        });
    (function(){ document.querySelector('#example')
                         .appendChild( new TButton() ); })();
</script>
~~~

{: .example .fragment }
><div id="example-34"></div>
><template class="t-button">
>    <style>
>        :host { background-color:#0f0; }
>        :host:hover { background-color:#ff0; }
>        :host:active { background-color:#f00; }
>        b { color:#00f }
>    </style>
>    <content></content><shadow></shadow> / <b></b>
></template>
><script>
>    var TButtonTemplate = document.querySelector('template.t-button');
>    var TButtonPrototype = Object.create(HTMLButtonElement.prototype);
>    TButtonPrototype.createdCallback = function(){
>        this.textContent = "TButton";
>        this.addEventListener('click', function(e){
>            var root = this.createShadowRoot(),
>                content = TButtonTemplate.content.cloneNode(true);
>                content.querySelector('b').textContent = (new Date()).toLocaleTimeString();
>            root.appendChild(content);
>            alert(this.outerHTML);
>        });
>    };
>    var TButton = document.registerElement('t-button', {
>        prototype: TButtonPrototype,
>        extends: 'button'
>        });
>    (function(){
>        document.querySelector('#example-34')
>                .appendChild( new TButton() );
>    })();
></script>

</section>

<!-- 35 -------------------------------------------------------------------- -->

<section markdown="1">

## [CUSTOM ELEMENTS](http://w3c.github.io/webcomponents/explainer/#custom-element-section)<br /><small>применение</small>

{: .fragment .highlight-current-blue .text-left }
#### Уже сейчас можно использовать возможности *Web Components* с помощью полифилов:

* {: .fragment .highlight-current-blue } [X-Tag - Web Components Custom Element Polylib (by Mozilla)](http://www.x-tags.org/), ([GitHub](https://github.com/x-tag))
* {: .fragment .highlight-current-blue } [Brick - UI Components for Modern Web Apps (by Mozilla)](http://mozilla.github.io/brick/), ([GitHub](https://github.com/mozilla/brick/))
* {: .fragment .highlight-current-blue } [Polymer by Google](http://www.polymer-project.org/)

{: .fragment .highlight-current-blue .text-left }
#### Каталоги компонент и UI-элементов на базе *X-Tag* и *Polymer*:

* {: .fragment .highlight-current-blue } [Polymer elements](http://www.polymer-project.org/docs/elements/)
* {: .fragment .highlight-current-blue } [Custom Elements - a web components gallery for modern web apps](http://customelements.io/)

</section>

<!-- ----------------------------------------------------------------------- -->

<section markdown="1">

## [WEB COMPONENTS](http://w3c.github.io/webcomponents/explainer/)<br /><small>источники</small>

* [W3C Introduction to Web Components](http://w3c.github.io/webcomponents/explainer/)
* [W3C Introduction to Web Components (rus)](https://github.com/termi/CreativeWork/blob/WCE/RU_ru/Web%20Components%20Explained/Translation.md)
* [W3C Shadow DOM](http://w3c.github.io/webcomponents/spec/shadow/)
* [W3C HTML Templates](https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/templates/index.html)
* [W3C HTML Imports](http://w3c.github.io/webcomponents/spec/imports/)
* [W3C Custom Elements](http://w3c.github.io/webcomponents/spec/custom/)
* [HTML5 Rocks / Shadow DOM 101](http://www.html5rocks.com/en/tutorials/webcomponents/shadowdom/)
* [HTML5 Rocks / Shadow DOM 201](http://www.html5rocks.com/en/tutorials/webcomponents/shadowdom-201/)
* [HTML5 Rocks / Shadow DOM 301](http://www.html5rocks.com/en/tutorials/webcomponents/shadowdom-301/)
* [HTML5 Rocks / HTML's New Template Tag](http://www.html5rocks.com/en/tutorials/webcomponents/template/)
* [HTML5 Rocks / HTML Imports](http://www.html5rocks.com/en/tutorials/webcomponents/imports/)
* [HTML5 Rocks / Custom Elements](http://www.html5rocks.com/en/tutorials/webcomponents/customelements/)
* [Custom Elements for Custom Applications – Web Components with Mozilla’s Brick and X-Tag](https://hacks.mozilla.org/2014/03/custom-elements-for-custom-applications-web-components-with-mozillas-brick-and-x-tag/)

</section>
